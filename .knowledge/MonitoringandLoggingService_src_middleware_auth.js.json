{"is_source_file": true, "format": "JavaScript", "description": "This file implements middleware functions for authentication and authorization in a Node.js web application. It provides JWT parsing, API key validation, and role-based access control.", "external_files": [], "external_methods": ["Buffer.from", "res.status", "res.json"], "published": ["authenticate", "requireRole"], "classes": [], "methods": [{"name": "getBearerToken(req)", "description": "Extracts the Bearer token from the Authorization header.", "scope": "", "scopeKind": ""}, {"name": "tryParseJwtPayload(token)", "description": "Naively parses JWT payload (base64 decoding) without validation.", "scope": "", "scopeKind": ""}, {"name": "authenticate(req, res, next)", "description": "Middleware that attaches authentication info to the request object based on JWT token or API key.", "scope": "", "scopeKind": ""}, {"name": "requireRole(minRole)", "description": "Middleware factory enforcing minimum role hierarchy for access control.", "scope": "", "scopeKind": ""}], "calls": ["Buffer.from", "res.status", "res.json"], "search-terms": ["JWT", "authorization", "middleware", "auth", "RBAC", "api key", "auth token parsing"], "state": 2, "file_id": 13, "knowledge_revision": 27, "git_revision": "", "ctags": [{"_type": "tag", "name": "authenticate", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^  authenticate,$/", "language": "JavaScript", "kind": "field", "scope": "module.exports", "scopeKind": "class"}, {"_type": "tag", "name": "authenticate", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^function authenticate(req, res, next) {$/", "language": "JavaScript", "kind": "function", "signature": "(req, res, next)"}, {"_type": "tag", "name": "getBearerToken", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^function getBearerToken(req) {$/", "language": "JavaScript", "kind": "function", "signature": "(req)"}, {"_type": "tag", "name": "isApiKey", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^        isApiKey: false,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "isApiKey", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^      isApiKey: true,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "isApiKey", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^    isApiKey: false,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "isAuthenticated", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^        isAuthenticated: true,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "isAuthenticated", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^      isAuthenticated: true,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "isAuthenticated", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^    isAuthenticated: false,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "principal", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^      principal = {$/", "language": "JavaScript", "kind": "class", "scope": "authenticate", "scopeKind": "class"}, {"_type": "tag", "name": "principal", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^    principal = {$/", "language": "JavaScript", "kind": "class", "scope": "authenticate", "scopeKind": "class"}, {"_type": "tag", "name": "principal", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^  let principal = {$/", "language": "JavaScript", "kind": "class", "scope": "authenticate", "scopeKind": "class"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^        raw: payload,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^      raw: { type: 'api-key' },$/", "language": "JavaScript", "kind": "class", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^    raw: null,$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "requireRole", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^function requireRole(minRole) {$/", "language": "JavaScript", "kind": "function", "signature": "(minRole)"}, {"_type": "tag", "name": "roles", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^        roles: Array.isArray(payload.roles) && payload.roles.length ? payload.roles : ['viewer']/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "roles", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^      roles: ['operator'], \\/\\/ allow ingestion privileges$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "roles", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^    roles: ['viewer'],$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "rolesHierarchy", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^const rolesHierarchy = ['viewer', 'analyst', 'operator', 'admin'];$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "subject", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^        subject: payload.sub || 'user',$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "subject", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^      subject: 'ingest-client',$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "subject", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^    subject: 'anonymous',$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal", "scopeKind": "class"}, {"_type": "tag", "name": "tryParseJwtPayload", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^function tryParseJwtPayload(token) {$/", "language": "JavaScript", "kind": "function", "signature": "(token)"}, {"_type": "tag", "name": "type", "path": "/home/kavia/workspace/code-generation/legacy-cycle-store-system-migration--cycle-store-4890-4601/MonitoringandLoggingService/src/middleware/auth.js", "pattern": "/^      raw: { type: 'api-key' },$/", "language": "JavaScript", "kind": "property", "scope": "authenticate.principal.raw", "scopeKind": "class"}], "hash": "160bfaa96ad979dbc1e7595bd633a4e4", "format-version": 4, "code-base-name": "MonitoringandLoggingService", "filename": "MonitoringandLoggingService/src/middleware/auth.js", "fields": [{"name": "authenticate,", "scope": "module.exports", "scopeKind": "class", "description": "unavailable"}, {"name": "isApiKey: false,", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "isApiKey: true,", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "isAuthenticated: true,", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "isAuthenticated: false,", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "raw: payload,", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "raw: null,", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "roles: Array.isArray(payload.roles) && payload.roles.length ? payload.roles : ['viewer']/", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "roles: ['operator'], \\/\\/ allow ingestion privileges", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "roles: ['viewer'],", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "subject: payload.sub || 'user',", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "subject: 'ingest-client',", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "subject: 'anonymous',", "scope": "authenticate.principal", "scopeKind": "class", "description": "unavailable"}, {"name": "raw: { type: 'api-key' },", "scope": "authenticate.principal.raw", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"27": ""}]}